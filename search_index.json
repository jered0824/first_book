[["data-processing.html", "Chapter 8 DATA PROCESSING 8.1 select 8.2 rename 8.3 filter 8.4 summarise 8.5 group_by 8.6 arrange 8.7 *_join 8.8 dplyr-test 8.9 applied_dplyr", " Chapter 8 DATA PROCESSING library(dplyr) ## Warning: 程辑包&#39;dplyr&#39;是用R版本4.3.2 来建造的 ## ## 载入程辑包：&#39;dplyr&#39; ## The following objects are masked from &#39;package:stats&#39;: ## ## filter, lag ## The following objects are masked from &#39;package:base&#39;: ## ## intersect, setdiff, setequal, union df &lt;- readr::read_csv(here::here(&quot;C:/wy/R_basic_code/demo_data/&quot;, &quot;score.csv&quot;)) ## Rows: 6 Columns: 3 ## ── Column specification ──────────────────────────────────────────────────────── ## Delimiter: &quot;,&quot; ## chr (2): name, type ## dbl (1): score ## ## ℹ Use `spec()` to retrieve the full column specification for this data. ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message. df ## # A tibble: 6 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Alice english 80 ## 2 Alice math 60 ## 3 Bob english 70 ## 4 Bob math 69 ## 5 Carol english 80 ## 6 Carol math 90 reward &lt;- c(2, 5, 9, 8, 5, 6) # mutate mutate(.data = df, extra = reward) ## # A tibble: 6 × 4 ## name type score extra ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Alice english 80 2 ## 2 Alice math 60 5 ## 3 Bob english 70 9 ## 4 Bob math 69 8 ## 5 Carol english 80 5 ## 6 Carol math 90 6 mutate(df, extra1 = c(2, 5, 9, 8, 5, 6), extra2 = c(1, 2, 3, 3, 2, 1), extra3 = c(8) ) ## # A tibble: 6 × 6 ## name type score extra1 extra2 extra3 ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Alice english 80 2 1 8 ## 2 Alice math 60 5 2 8 ## 3 Bob english 70 9 3 8 ## 4 Bob math 69 8 3 8 ## 5 Carol english 80 5 2 8 ## 6 Carol math 90 6 1 8 # %&gt;% sum(c(1:10)) ## [1] 55 c(1:10) %&gt;% sum() ## [1] 55 sqrt(sum(abs(c(-10:10)))) ## [1] 10.48809 c(-10:10) %&gt;% abs() %&gt;% sum() %&gt;% sqrt() ## [1] 10.48809 df %&gt;% mutate(extra = reward) ## # A tibble: 6 × 4 ## name type score extra ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Alice english 80 2 ## 2 Alice math 60 5 ## 3 Bob english 70 9 ## 4 Bob math 69 8 ## 5 Carol english 80 5 ## 6 Carol math 90 6 8.1 select df %&gt;% select(starts_with(&quot;s&quot;)) # starts_with 以*开头 ## # A tibble: 6 × 1 ## score ## &lt;dbl&gt; ## 1 80 ## 2 60 ## 3 70 ## 4 69 ## 5 80 ## 6 90 df %&gt;% select(ends_with(&quot;e&quot;)) # ends_with 以*结尾 ## # A tibble: 6 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Alice english 80 ## 2 Alice math 60 ## 3 Bob english 70 ## 4 Bob math 69 ## 5 Carol english 80 ## 6 Carol math 90 df %&gt;% select(contains(&quot;score&quot;)) # contain 包含*的列 ## # A tibble: 6 × 1 ## score ## &lt;dbl&gt; ## 1 80 ## 2 60 ## 3 70 ## 4 69 ## 5 80 ## 6 90 df %&gt;% select(where(is.character)) # 根据变量类型选取 ## # A tibble: 6 × 2 ## name type ## &lt;chr&gt; &lt;chr&gt; ## 1 Alice english ## 2 Alice math ## 3 Bob english ## 4 Bob math ## 5 Carol english ## 6 Carol math df %&gt;% select(where(is.numeric)) ## # A tibble: 6 × 1 ## score ## &lt;dbl&gt; ## 1 80 ## 2 60 ## 3 70 ## 4 69 ## 5 80 ## 6 90 df %&gt;% select(where(is.numeric) &amp; starts_with(&quot;s&quot;)) ## # A tibble: 6 × 1 ## score ## &lt;dbl&gt; ## 1 80 ## 2 60 ## 3 70 ## 4 69 ## 5 80 ## 6 90 df %&gt;% select(starts_with(&quot;s&quot;) | ends_with(&quot;e&quot;)) ## # A tibble: 6 × 3 ## score name type ## &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; ## 1 80 Alice english ## 2 60 Alice math ## 3 70 Bob english ## 4 69 Bob math ## 5 80 Carol english ## 6 90 Carol math df %&gt;% select(!starts_with(&quot;s&quot;)) # !- 不包含 ## # A tibble: 6 × 2 ## name type ## &lt;chr&gt; &lt;chr&gt; ## 1 Alice english ## 2 Alice math ## 3 Bob english ## 4 Bob math ## 5 Carol english ## 6 Carol math 8.2 rename df %&gt;% select(name, type, score) %&gt;% rename(total_score = score) ## # A tibble: 6 × 3 ## name type total_score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Alice english 80 ## 2 Alice math 60 ## 3 Bob english 70 ## 4 Bob math 69 ## 5 Carol english 80 ## 6 Carol math 90 8.3 filter #比较关系的算符: &lt;, &gt;, &lt;=, &gt;=, == (equal), != (not equal), %in%, is.na() 和 !is.na() df %&gt;% filter(score == 90) ## # A tibble: 1 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Carol math 90 df %&gt;% filter(score &gt;= 80) ## # A tibble: 3 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Alice english 80 ## 2 Carol english 80 ## 3 Carol math 90 df %&gt;% filter(type == &quot;english&quot;, score &gt;= 75) ## # A tibble: 2 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Alice english 80 ## 2 Carol english 80 df %&gt;% filter(type == &quot;english&quot; &amp; score &gt;= 75) ## # A tibble: 2 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Alice english 80 ## 2 Carol english 80 df %&gt;% filter(score == 70 | score == 90) ## # A tibble: 2 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Bob english 70 ## 2 Carol math 90 df %&gt;% filter(score %in% c(70, 90)) ## # A tibble: 2 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Bob english 70 ## 2 Carol math 90 df %&gt;% filter(score == max(score)) ## # A tibble: 1 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Carol math 90 df %&gt;% filter(score &gt; mean(score)) ## # A tibble: 3 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Alice english 80 ## 2 Carol english 80 ## 3 Carol math 90 8.4 summarise df %&gt;% summarise(mean_score = mean(score)) ## # A tibble: 1 × 1 ## mean_score ## &lt;dbl&gt; ## 1 74.8 df %&gt;% summarise(sd_score = sd(score)) ## # A tibble: 1 × 1 ## sd_score ## &lt;dbl&gt; ## 1 10.6 df %&gt;% summarise( mean_score = mean(score), median_score = median(score), n = n(), sum = sum(score) ) ## # A tibble: 1 × 4 ## mean_score median_score n sum ## &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; ## 1 74.8 75 6 449 8.5 group_by # 分组汇总 df %&gt;% group_by(name) %&gt;% summarise( mean_score = mean(score), sd_score = sd(score) ) ## # A tibble: 3 × 3 ## name mean_score sd_score ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Alice 70 14.1 ## 2 Bob 69.5 0.707 ## 3 Carol 85 7.07 8.6 arrange df %&gt;% arrange(score) # aescend ## # A tibble: 6 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Alice math 60 ## 2 Bob math 69 ## 3 Bob english 70 ## 4 Alice english 80 ## 5 Carol english 80 ## 6 Carol math 90 df %&gt;% arrange(-score) # descend ## # A tibble: 6 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Carol math 90 ## 2 Alice english 80 ## 3 Carol english 80 ## 4 Bob english 70 ## 5 Bob math 69 ## 6 Alice math 60 df %&gt;% arrange(desc(score)) ## # A tibble: 6 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Carol math 90 ## 2 Alice english 80 ## 3 Carol english 80 ## 4 Bob english 70 ## 5 Bob math 69 ## 6 Alice math 60 df %&gt;% arrange(type, desc(score)) # 多变量依次排序 ## # A tibble: 6 × 3 ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Alice english 80 ## 2 Carol english 80 ## 3 Bob english 70 ## 4 Carol math 90 ## 5 Bob math 69 ## 6 Alice math 60 8.7 *_join df1 &lt;- df %&gt;% group_by(name) %&gt;% summarise( mean_score = mean(score) ) df1 ## # A tibble: 3 × 2 ## name mean_score ## &lt;chr&gt; &lt;dbl&gt; ## 1 Alice 70 ## 2 Bob 69.5 ## 3 Carol 85 df2 &lt;- tibble( name = c(&quot;Alice&quot;, &quot;Bob&quot;, &quot;Dave&quot;), age = c(12, 13, 14) ) df2 ## # A tibble: 3 × 2 ## name age ## &lt;chr&gt; &lt;dbl&gt; ## 1 Alice 12 ## 2 Bob 13 ## 3 Dave 14 left_join(df1, df2, by = &quot;name&quot;) # 基于df1 ## # A tibble: 3 × 3 ## name mean_score age ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Alice 70 12 ## 2 Bob 69.5 13 ## 3 Carol 85 NA # using %&gt;% df1 %&gt;% left_join(df2, by = &quot;name&quot;) ## # A tibble: 3 × 3 ## name mean_score age ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Alice 70 12 ## 2 Bob 69.5 13 ## 3 Carol 85 NA df1 %&gt;% right_join(df2, by = &quot;name&quot;) # 基于df2 ## # A tibble: 3 × 3 ## name mean_score age ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Alice 70 12 ## 2 Bob 69.5 13 ## 3 Dave NA 14 df1 %&gt;% full_join(df2, by = &quot;name&quot;) # df1 | df2 ## # A tibble: 4 × 3 ## name mean_score age ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Alice 70 12 ## 2 Bob 69.5 13 ## 3 Carol 85 NA ## 4 Dave NA 14 df1 %&gt;% inner_join(df2, by = &quot;name&quot;) # df1 &amp; df2 ## # A tibble: 2 × 3 ## name mean_score age ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Alice 70 12 ## 2 Bob 69.5 13 df1 %&gt;% semi_join(df2, by = &quot;name&quot;) # 仅保留一致 不合并 ## # A tibble: 2 × 2 ## name mean_score ## &lt;chr&gt; &lt;dbl&gt; ## 1 Alice 70 ## 2 Bob 69.5 df1 %&gt;% anti_join(df2, by = &quot;name&quot;) # 仅保留不一致 不合并 ## # A tibble: 1 × 2 ## name mean_score ## &lt;chr&gt; &lt;dbl&gt; ## 1 Carol 85 8.8 dplyr-test df %&gt;% group_by(name) %&gt;% summarise(score_75puls_subject = sum(score &gt; 75)) ## # A tibble: 3 × 2 ## name score_75puls_subject ## &lt;chr&gt; &lt;int&gt; ## 1 Alice 1 ## 2 Bob 0 ## 3 Carol 2 df %&gt;% group_by(name) %&gt;% summarise(mean_score = mean(score)) ## # A tibble: 3 × 2 ## name mean_score ## &lt;chr&gt; &lt;dbl&gt; ## 1 Alice 70 ## 2 Bob 69.5 ## 3 Carol 85 df %&gt;% group_by(name) %&gt;% mutate(mean_score = mean(score)) ## # A tibble: 6 × 4 ## # Groups: name [3] ## name type score mean_score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Alice english 80 70 ## 2 Alice math 60 70 ## 3 Bob english 70 69.5 ## 4 Bob math 69 69.5 ## 5 Carol english 80 85 ## 6 Carol math 90 85 d &lt;- tibble::tribble( ~name, ~score, &quot;a1&quot;, 2, &quot;a2&quot;, 5, &quot;a3&quot;, 3, &quot;a4&quot;, 7, &quot;a5&quot;, 6, &quot;all&quot;, 23 ) d %&gt;% arrange(desc(name %in% c(&quot;all&quot;)),desc(score)) ## # A tibble: 6 × 2 ## name score ## &lt;chr&gt; &lt;dbl&gt; ## 1 all 23 ## 2 a4 7 ## 3 a5 6 ## 4 a2 5 ## 5 a3 3 ## 6 a1 2 # all可以放到放到最后一行 #解释：name %in% c(&quot;all&quot;) 会产生布尔逻辑值 all 为TRUE(1),其他name变量都为0，默认升序排列故all会在最后一行，desc()则会排最后一行 8.9 applied_dplyr library(tidyverse) ## Warning: 程辑包&#39;tidyverse&#39;是用R版本4.3.2 来建造的 ## Warning: 程辑包&#39;ggplot2&#39;是用R版本4.3.2 来建造的 ## Warning: 程辑包&#39;tidyr&#39;是用R版本4.3.2 来建造的 ## Warning: 程辑包&#39;readr&#39;是用R版本4.3.2 来建造的 ## Warning: 程辑包&#39;forcats&#39;是用R版本4.3.2 来建造的 ## Warning: 程辑包&#39;lubridate&#39;是用R版本4.3.2 来建造的 ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ── ## ✔ forcats 1.0.0 ✔ readr 2.1.4 ## ✔ ggplot2 3.5.0 ✔ stringr 1.5.0 ## ✔ lubridate 1.9.3 ✔ tibble 3.2.1 ## ✔ purrr 1.0.2 ✔ tidyr 1.3.0 ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ── ## ✖ dplyr::filter() masks stats::filter() ## ✖ dplyr::lag() masks stats::lag() ## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors library(palmerpenguins) ## Warning: 程辑包&#39;palmerpenguins&#39;是用R版本4.3.2 来建造的 penguins &lt;- penguins %&gt;% drop_na() penguins %&gt;% select(bill_length_mm, bill_depth_mm) ## # A tibble: 333 × 2 ## bill_length_mm bill_depth_mm ## &lt;dbl&gt; &lt;dbl&gt; ## 1 39.1 18.7 ## 2 39.5 17.4 ## 3 40.3 18 ## 4 36.7 19.3 ## 5 39.3 20.6 ## 6 38.9 17.8 ## 7 39.2 19.6 ## 8 41.1 17.6 ## 9 38.6 21.2 ## 10 34.6 21.1 ## # ℹ 323 more rows penguins %&gt;% select(starts_with(&quot;bill_&quot;)) ## # A tibble: 333 × 2 ## bill_length_mm bill_depth_mm ## &lt;dbl&gt; &lt;dbl&gt; ## 1 39.1 18.7 ## 2 39.5 17.4 ## 3 40.3 18 ## 4 36.7 19.3 ## 5 39.3 20.6 ## 6 38.9 17.8 ## 7 39.2 19.6 ## 8 41.1 17.6 ## 9 38.6 21.2 ## 10 34.6 21.1 ## # ℹ 323 more rows penguins %&gt;% select(ends_with(&quot;_mm&quot;)) ## # A tibble: 333 × 3 ## bill_length_mm bill_depth_mm flipper_length_mm ## &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; ## 1 39.1 18.7 181 ## 2 39.5 17.4 186 ## 3 40.3 18 195 ## 4 36.7 19.3 193 ## 5 39.3 20.6 190 ## 6 38.9 17.8 181 ## 7 39.2 19.6 195 ## 8 41.1 17.6 182 ## 9 38.6 21.2 191 ## 10 34.6 21.1 198 ## # ℹ 323 more rows penguins %&gt;% select(contains(&quot;length&quot;)) ## # A tibble: 333 × 2 ## bill_length_mm flipper_length_mm ## &lt;dbl&gt; &lt;int&gt; ## 1 39.1 181 ## 2 39.5 186 ## 3 40.3 195 ## 4 36.7 193 ## 5 39.3 190 ## 6 38.9 181 ## 7 39.2 195 ## 8 41.1 182 ## 9 38.6 191 ## 10 34.6 198 ## # ℹ 323 more rows penguins %&gt;% select(where(is.numeric)) ## # A tibble: 333 × 5 ## bill_length_mm bill_depth_mm flipper_length_mm body_mass_g year ## &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; ## 1 39.1 18.7 181 3750 2007 ## 2 39.5 17.4 186 3800 2007 ## 3 40.3 18 195 3250 2007 ## 4 36.7 19.3 193 3450 2007 ## 5 39.3 20.6 190 3650 2007 ## 6 38.9 17.8 181 3625 2007 ## 7 39.2 19.6 195 4675 2007 ## 8 41.1 17.6 182 3200 2007 ## 9 38.6 21.2 191 3800 2007 ## 10 34.6 21.1 198 4400 2007 ## # ℹ 323 more rows penguins %&gt;% select(where(is.character)) ## # A tibble: 333 × 0 penguins %&gt;% select(!where(is.character)) ## # A tibble: 333 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 39.1 18.7 181 3750 ## 2 Adelie Torgersen 39.5 17.4 186 3800 ## 3 Adelie Torgersen 40.3 18 195 3250 ## 4 Adelie Torgersen 36.7 19.3 193 3450 ## 5 Adelie Torgersen 39.3 20.6 190 3650 ## 6 Adelie Torgersen 38.9 17.8 181 3625 ## 7 Adelie Torgersen 39.2 19.6 195 4675 ## 8 Adelie Torgersen 41.1 17.6 182 3200 ## 9 Adelie Torgersen 38.6 21.2 191 3800 ## 10 Adelie Torgersen 34.6 21.1 198 4400 ## # ℹ 323 more rows ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% select(species, starts_with(&quot;bill_&quot;)) ## # A tibble: 333 × 3 ## species bill_length_mm bill_depth_mm ## &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Adelie 39.1 18.7 ## 2 Adelie 39.5 17.4 ## 3 Adelie 40.3 18 ## 4 Adelie 36.7 19.3 ## 5 Adelie 39.3 20.6 ## 6 Adelie 38.9 17.8 ## 7 Adelie 39.2 19.6 ## 8 Adelie 41.1 17.6 ## 9 Adelie 38.6 21.2 ## 10 Adelie 34.6 21.1 ## # ℹ 323 more rows penguins[[&quot;species&quot;]] ## [1] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [8] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [15] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [22] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [29] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [36] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [43] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [50] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [57] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [64] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [71] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [78] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [85] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [92] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [99] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [106] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [113] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [120] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [127] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [134] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [141] Adelie Adelie Adelie Adelie Adelie Adelie Gentoo ## [148] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [155] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [162] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [169] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [176] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [183] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [190] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [197] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [204] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [211] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [218] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [225] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [232] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [239] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [246] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [253] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [260] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Chinstrap ## [267] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [274] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [281] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [288] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [295] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [302] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [309] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [316] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [323] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [330] Chinstrap Chinstrap Chinstrap Chinstrap ## Levels: Adelie Chinstrap Gentoo penguins$species ## [1] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [8] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [15] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [22] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [29] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [36] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [43] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [50] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [57] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [64] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [71] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [78] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [85] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [92] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [99] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [106] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [113] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [120] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [127] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [134] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [141] Adelie Adelie Adelie Adelie Adelie Adelie Gentoo ## [148] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [155] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [162] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [169] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [176] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [183] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [190] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [197] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [204] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [211] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [218] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [225] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [232] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [239] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [246] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [253] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [260] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Chinstrap ## [267] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [274] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [281] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [288] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [295] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [302] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [309] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [316] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [323] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [330] Chinstrap Chinstrap Chinstrap Chinstrap ## Levels: Adelie Chinstrap Gentoo penguins %&gt;% pull(species) # 返回向量 ## [1] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [8] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [15] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [22] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [29] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [36] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [43] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [50] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [57] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [64] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [71] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [78] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [85] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [92] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [99] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [106] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [113] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [120] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [127] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [134] Adelie Adelie Adelie Adelie Adelie Adelie Adelie ## [141] Adelie Adelie Adelie Adelie Adelie Adelie Gentoo ## [148] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [155] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [162] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [169] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [176] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [183] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [190] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [197] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [204] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [211] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [218] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [225] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [232] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [239] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [246] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [253] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo ## [260] Gentoo Gentoo Gentoo Gentoo Gentoo Gentoo Chinstrap ## [267] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [274] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [281] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [288] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [295] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [302] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [309] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [316] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [323] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap ## [330] Chinstrap Chinstrap Chinstrap Chinstrap ## Levels: Adelie Chinstrap Gentoo penguins[&quot;species&quot;] ## # A tibble: 333 × 1 ## species ## &lt;fct&gt; ## 1 Adelie ## 2 Adelie ## 3 Adelie ## 4 Adelie ## 5 Adelie ## 6 Adelie ## 7 Adelie ## 8 Adelie ## 9 Adelie ## 10 Adelie ## # ℹ 323 more rows penguins %&gt;% select(species) # 返回数据框 ## # A tibble: 333 × 1 ## species ## &lt;fct&gt; ## 1 Adelie ## 2 Adelie ## 3 Adelie ## 4 Adelie ## 5 Adelie ## 6 Adelie ## 7 Adelie ## 8 Adelie ## 9 Adelie ## 10 Adelie ## # ℹ 323 more rows tb &lt;- tibble( x = 1:5, y = 0, z = 5:1, w = 0 ) tb ## # A tibble: 5 × 4 ## x y z w ## &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; ## 1 1 0 5 0 ## 2 2 0 4 0 ## 3 3 0 3 0 ## 4 4 0 2 0 ## 5 5 0 1 0 myfun &lt;- function(x) sum(x) == 0 tb %&gt;% select(where(myfun)) ## # A tibble: 5 × 2 ## y w ## &lt;dbl&gt; &lt;dbl&gt; ## 1 0 0 ## 2 0 0 ## 3 0 0 ## 4 0 0 ## 5 0 0 # or tb %&gt;% select(where(~sum(.x) == 0)) ## # A tibble: 5 × 2 ## y w ## &lt;dbl&gt; &lt;dbl&gt; ## 1 0 0 ## 2 0 0 ## 3 0 0 ## 4 0 0 ## 5 0 0 df &lt;- tibble( x = c(NA, NA, NA), y = c(2, 3, NA), z = c(NA, 5, NA) ) df %&gt;% # 删除全为NA值的列 select(!where(~all(is.na(.x)))) # all检查所有逻辑值是否T ## # A tibble: 3 × 2 ## y z ## &lt;dbl&gt; &lt;dbl&gt; ## 1 2 NA ## 2 3 5 ## 3 NA NA # or df %&gt;% # 删除全为NA值的行 filter(if_any(everything(), ~!is.na(.x))) ## # A tibble: 2 × 3 ## x y z ## &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 NA 2 NA ## 2 NA 3 5 penguins %&gt;% filter(sex == &quot;male&quot;) ## # A tibble: 168 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 39.1 18.7 181 3750 ## 2 Adelie Torgersen 39.3 20.6 190 3650 ## 3 Adelie Torgersen 39.2 19.6 195 4675 ## 4 Adelie Torgersen 38.6 21.2 191 3800 ## 5 Adelie Torgersen 34.6 21.1 198 4400 ## 6 Adelie Torgersen 42.5 20.7 197 4500 ## 7 Adelie Torgersen 46 21.5 194 4200 ## 8 Adelie Biscoe 37.7 18.7 180 3600 ## 9 Adelie Biscoe 38.2 18.1 185 3950 ## 10 Adelie Biscoe 38.8 17.2 180 3800 ## # ℹ 158 more rows ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% filter(species %in% c(&quot;Adelie&quot;, &quot;Gentoo&quot;)) ## # A tibble: 265 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 39.1 18.7 181 3750 ## 2 Adelie Torgersen 39.5 17.4 186 3800 ## 3 Adelie Torgersen 40.3 18 195 3250 ## 4 Adelie Torgersen 36.7 19.3 193 3450 ## 5 Adelie Torgersen 39.3 20.6 190 3650 ## 6 Adelie Torgersen 38.9 17.8 181 3625 ## 7 Adelie Torgersen 39.2 19.6 195 4675 ## 8 Adelie Torgersen 41.1 17.6 182 3200 ## 9 Adelie Torgersen 38.6 21.2 191 3800 ## 10 Adelie Torgersen 34.6 21.1 198 4400 ## # ℹ 255 more rows ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% filter(species == &quot;Adelie&quot; &amp; bill_length_mm &gt; 40) ## # A tibble: 50 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 40.3 18 195 3250 ## 2 Adelie Torgersen 41.1 17.6 182 3200 ## 3 Adelie Torgersen 42.5 20.7 197 4500 ## 4 Adelie Torgersen 46 21.5 194 4200 ## 5 Adelie Biscoe 40.6 18.6 183 3550 ## 6 Adelie Biscoe 40.5 17.9 187 3200 ## 7 Adelie Biscoe 40.5 18.9 180 3950 ## 8 Adelie Dream 40.9 18.9 184 3900 ## 9 Adelie Dream 42.2 18.5 180 3550 ## 10 Adelie Dream 40.8 18.4 195 3900 ## # ℹ 40 more rows ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% filter(species == &quot;Adelie&quot;, bill_length_mm &gt; 40) ## # A tibble: 50 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 40.3 18 195 3250 ## 2 Adelie Torgersen 41.1 17.6 182 3200 ## 3 Adelie Torgersen 42.5 20.7 197 4500 ## 4 Adelie Torgersen 46 21.5 194 4200 ## 5 Adelie Biscoe 40.6 18.6 183 3550 ## 6 Adelie Biscoe 40.5 17.9 187 3200 ## 7 Adelie Biscoe 40.5 18.9 180 3950 ## 8 Adelie Dream 40.9 18.9 184 3900 ## 9 Adelie Dream 42.2 18.5 180 3550 ## 10 Adelie Dream 40.8 18.4 195 3900 ## # ℹ 40 more rows ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% filter(species == &quot;Gentoo&quot;, bill_length_mm == max(bill_length_mm) ) ## # A tibble: 1 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Gentoo Biscoe 59.6 17 230 6050 ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% #查看数据 head() ## # A tibble: 6 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 39.1 18.7 181 3750 ## 2 Adelie Torgersen 39.5 17.4 186 3800 ## 3 Adelie Torgersen 40.3 18 195 3250 ## 4 Adelie Torgersen 36.7 19.3 193 3450 ## 5 Adelie Torgersen 39.3 20.6 190 3650 ## 6 Adelie Torgersen 38.9 17.8 181 3625 ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% tail() ## # A tibble: 6 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Chinstrap Dream 45.7 17 195 3650 ## 2 Chinstrap Dream 55.8 19.8 207 4000 ## 3 Chinstrap Dream 43.5 18.1 202 3400 ## 4 Chinstrap Dream 49.6 18.2 193 3775 ## 5 Chinstrap Dream 50.8 19 210 4100 ## 6 Chinstrap Dream 50.2 18.7 198 3775 ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% slice(1) ## # A tibble: 1 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 39.1 18.7 181 3750 ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% group_by(species) %&gt;% slice(1) ## # A tibble: 3 × 8 ## # Groups: species [3] ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 39.1 18.7 181 3750 ## 2 Chinstrap Dream 46.5 17.9 192 3500 ## 3 Gentoo Biscoe 46.1 13.2 211 4500 ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% # 选最大值 filter(bill_length_mm == max(bill_length_mm)) ## # A tibble: 1 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Gentoo Biscoe 59.6 17 230 6050 ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% arrange(desc(bill_length_mm)) %&gt;% slice(1) ## # A tibble: 1 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Gentoo Biscoe 59.6 17 230 6050 ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; penguins %&gt;% slice_max(bill_length_mm) ## # A tibble: 1 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Gentoo Biscoe 59.6 17 230 6050 ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; tb &lt;- tibble::tribble( # 特征分列 ~day, ~price, 1, &quot;30-45&quot;, 2, &quot;40-95&quot;, 3, &quot;89-65&quot;, 4, &quot;45-63&quot;, 5, &quot;52-42&quot; ) tb1 &lt;- tb %&gt;% separate(price, into = c(&quot;low&quot;, &quot;high&quot;), sep = &quot;-&quot;) tb1 ## # A tibble: 5 × 3 ## day low high ## &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; ## 1 1 30 45 ## 2 2 40 95 ## 3 3 89 65 ## 4 4 45 63 ## 5 5 52 42 tb1 %&gt;% unite(col = &quot;price&quot;, c(low, high), sep = &quot;:&quot;, remove = FALSE) # remove = FALSE 不去除原有列 默认 remove = T ## # A tibble: 5 × 4 ## day price low high ## &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 1 30:45 30 45 ## 2 2 40:95 40 95 ## 3 3 89:65 89 65 ## 4 4 45:63 45 63 ## 5 5 52:42 52 42 df &lt;- tibble::tribble( ~x, ~y, ~z, 1, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1, 2, 2, 2, 3, 3, 3, 1 ) df ## # A tibble: 6 × 3 ## x y z ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 1 1 1 ## 2 1 1 2 ## 3 1 1 1 ## 4 2 1 2 ## 5 2 2 3 ## 6 3 3 1 df %&gt;% distinct() # 行去重 ## # A tibble: 5 × 3 ## x y z ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 1 1 1 ## 2 1 1 2 ## 3 2 1 2 ## 4 2 2 3 ## 5 3 3 1 df %&gt;% distinct(x) ## # A tibble: 3 × 1 ## x ## &lt;dbl&gt; ## 1 1 ## 2 2 ## 3 3 df %&gt;% distinct(x, y) ## # A tibble: 4 × 2 ## x y ## &lt;dbl&gt; &lt;dbl&gt; ## 1 1 1 ## 2 2 1 ## 3 2 2 ## 4 3 3 df %&gt;% distinct(x, y, .keep_all = TRUE) # 只保留最先出现的row ## # A tibble: 4 × 3 ## x y z ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 1 1 1 ## 2 2 1 2 ## 3 2 2 3 ## 4 3 3 1 # .keep_all 保留所有列 df %&gt;% distinct(across(c(x, y)),.keep_all = TRUE) ## # A tibble: 4 × 3 ## x y z ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 1 1 1 ## 2 2 1 2 ## 3 2 2 3 ## 4 3 3 1 df %&gt;% group_by(x) %&gt;% distinct(y, .keep_all = TRUE) # 在x每个组中，去重Y列 ## # A tibble: 4 × 3 ## # Groups: x [3] ## x y z ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 1 1 1 ## 2 2 1 2 ## 3 2 2 3 ## 4 3 3 1 c(1, 1, 1, 2, 2, 1, 3, 3) %&gt;% n_distinct() ## [1] 3 # vector 统计元素个数 df %&gt;% group_by(x) %&gt;% summarise(n = n_distinct(z)) ## # A tibble: 3 × 2 ## x n ## &lt;dbl&gt; &lt;int&gt; ## 1 1 2 ## 2 2 2 ## 3 3 1 # NA的计算 sum(c(1, 2, NA, 4), na.rm = TRUE) ## [1] 7 mean(c(1, 2, NA, 4), na.rm = TRUE) ## [1] 2.333333 #if_else + mutate 二分类条件 penguins %&gt;% mutate( body = if_else(body_mass_g &gt; 4200, &quot;you are fat&quot;, &quot;you are fine&quot;) ) ## # A tibble: 333 × 9 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 39.1 18.7 181 3750 ## 2 Adelie Torgersen 39.5 17.4 186 3800 ## 3 Adelie Torgersen 40.3 18 195 3250 ## 4 Adelie Torgersen 36.7 19.3 193 3450 ## 5 Adelie Torgersen 39.3 20.6 190 3650 ## 6 Adelie Torgersen 38.9 17.8 181 3625 ## 7 Adelie Torgersen 39.2 19.6 195 4675 ## 8 Adelie Torgersen 41.1 17.6 182 3200 ## 9 Adelie Torgersen 38.6 21.2 191 3800 ## 10 Adelie Torgersen 34.6 21.1 198 4400 ## # ℹ 323 more rows ## # ℹ 3 more variables: sex &lt;fct&gt;, year &lt;int&gt;, body &lt;chr&gt; df &lt;- tibble::tribble( ~name, ~type, ~score, &quot;Alice&quot;, &quot;english&quot;, 80, &quot;Alice&quot;, &quot;math&quot;, NA, &quot;Bob&quot;, &quot;english&quot;, 70, &quot;Bob&quot;, &quot;math&quot;, 69, &quot;Carol&quot;, &quot;english&quot;, NA, &quot;Carol&quot;, &quot;math&quot;, 90 ) df %&gt;% group_by(type) %&gt;% mutate(score = if_else(is.na(score),mean(score,na.rm = T),score)) ## # A tibble: 6 × 3 ## # Groups: type [2] ## name type score ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; ## 1 Alice english 80 ## 2 Alice math 79.5 ## 3 Bob english 70 ## 4 Bob math 69 ## 5 Carol english 75 ## 6 Carol math 90 # case_when + mutate 多分类条件 penguins %&gt;% mutate( body = case_when( body_mass_g &lt; 3500 ~ &quot;best&quot;, body_mass_g &gt;= 3500 &amp; body_mass_g &lt; 4500 ~ &quot;good&quot;, body_mass_g &gt;= 4500 &amp; body_mass_g &lt; 5500 ~ &quot;general&quot;, TRUE ~ &quot;other&quot; ) ) ## # A tibble: 333 × 9 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 39.1 18.7 181 3750 ## 2 Adelie Torgersen 39.5 17.4 186 3800 ## 3 Adelie Torgersen 40.3 18 195 3250 ## 4 Adelie Torgersen 36.7 19.3 193 3450 ## 5 Adelie Torgersen 39.3 20.6 190 3650 ## 6 Adelie Torgersen 38.9 17.8 181 3625 ## 7 Adelie Torgersen 39.2 19.6 195 4675 ## 8 Adelie Torgersen 41.1 17.6 182 3200 ## 9 Adelie Torgersen 38.6 21.2 191 3800 ## 10 Adelie Torgersen 34.6 21.1 198 4400 ## # ℹ 323 more rows ## # ℹ 3 more variables: sex &lt;fct&gt;, year &lt;int&gt;, body &lt;chr&gt; penguins %&gt;% mutate( degree = case_when( bill_length_mm &lt; 35 ~ &quot;A&quot;, bill_length_mm &gt;= 35 &amp; bill_length_mm &lt; 45 ~ &quot;B&quot;, bill_length_mm &gt;= 45 &amp; bill_length_mm &lt; 55 ~ &quot;C&quot;, TRUE ~ &quot;D&quot; ) ) ## # A tibble: 333 × 9 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen 39.1 18.7 181 3750 ## 2 Adelie Torgersen 39.5 17.4 186 3800 ## 3 Adelie Torgersen 40.3 18 195 3250 ## 4 Adelie Torgersen 36.7 19.3 193 3450 ## 5 Adelie Torgersen 39.3 20.6 190 3650 ## 6 Adelie Torgersen 38.9 17.8 181 3625 ## 7 Adelie Torgersen 39.2 19.6 195 4675 ## 8 Adelie Torgersen 41.1 17.6 182 3200 ## 9 Adelie Torgersen 38.6 21.2 191 3800 ## 10 Adelie Torgersen 34.6 21.1 198 4400 ## # ℹ 323 more rows ## # ℹ 3 more variables: sex &lt;fct&gt;, year &lt;int&gt;, degree &lt;chr&gt; penguins %&gt;% summarise( n = n() ) ## # A tibble: 1 × 1 ## n ## &lt;int&gt; ## 1 333 penguins %&gt;% group_by(species) %&gt;% summarise( n = n() # n() 统计当前分组每个元素数据框行数 ) ## # A tibble: 3 × 2 ## species n ## &lt;fct&gt; &lt;int&gt; ## 1 Adelie 146 ## 2 Chinstrap 68 ## 3 Gentoo 119 penguins %&gt;% count(species) # 统计某列各元素出现次数 ## # A tibble: 3 × 2 ## species n ## &lt;fct&gt; &lt;int&gt; ## 1 Adelie 146 ## 2 Chinstrap 68 ## 3 Gentoo 119 penguins %&gt;% count(sex, sort = TRUE) # 不同性别 ## # A tibble: 2 × 2 ## sex n ## &lt;fct&gt; &lt;int&gt; ## 1 male 168 ## 2 female 165 penguins %&gt;% count(island, species) # 不同组和统计 ## # A tibble: 5 × 3 ## island species n ## &lt;fct&gt; &lt;fct&gt; &lt;int&gt; ## 1 Biscoe Adelie 44 ## 2 Biscoe Gentoo 119 ## 3 Dream Adelie 55 ## 4 Dream Chinstrap 68 ## 5 Torgersen Adelie 47 penguins %&gt;% filter(bill_length_mm &gt; 40) %&gt;% summarise( n = n() ) ## # A tibble: 1 × 1 ## n ## &lt;int&gt; ## 1 237 penguins %&gt;% count(bill_length_mm &gt; 40,sort = TRUE) # 相当于统计 T F 个数 ## # A tibble: 2 × 2 ## `bill_length_mm &gt; 40` n ## &lt;lgl&gt; &lt;int&gt; ## 1 TRUE 237 ## 2 FALSE 96 # 统计某列满足条件的行占比 penguins %&gt;% mutate(is_bigger40 = bill_length_mm &gt; 40) %&gt;% summarise(percentage_bigger40 = sum(is_bigger40)/n() * 100) ## # A tibble: 1 × 1 ## percentage_bigger40 ## &lt;dbl&gt; ## 1 71.2 # summarise(percentage_bigger40 = mean(is_bigger40) * 100) # across + summarize penguins %&gt;% summarize( length = mean(bill_length_mm) ) ## # A tibble: 1 × 1 ## length ## &lt;dbl&gt; ## 1 44.0 penguins %&gt;% summarize( length = mean(bill_length_mm), depth = mean(bill_depth_mm) ) ## # A tibble: 1 × 2 ## length depth ## &lt;dbl&gt; &lt;dbl&gt; ## 1 44.0 17.2 penguins %&gt;% summarize( across(c(bill_depth_mm, bill_length_mm), mean) ) ## # A tibble: 1 × 2 ## bill_depth_mm bill_length_mm ## &lt;dbl&gt; &lt;dbl&gt; ## 1 17.2 44.0 penguins %&gt;% summarize( across(c(bill_depth_mm, bill_length_mm, flipper_length_mm), mean) ) ## # A tibble: 1 × 3 ## bill_depth_mm bill_length_mm flipper_length_mm ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 17.2 44.0 201. penguins %&gt;% summarize( across(ends_with(&quot;_mm&quot;), mean) ) ## # A tibble: 1 × 3 ## bill_length_mm bill_depth_mm flipper_length_mm ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 44.0 17.2 201. # 数据中心化 mutate + across penguins %&gt;% mutate( bill_length_mm = bill_length_mm - mean(bill_length_mm), bill_depth_mm = bill_depth_mm - mean(bill_depth_mm) ) ## # A tibble: 333 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen -4.89 1.54 181 3750 ## 2 Adelie Torgersen -4.49 0.235 186 3800 ## 3 Adelie Torgersen -3.69 0.835 195 3250 ## 4 Adelie Torgersen -7.29 2.14 193 3450 ## 5 Adelie Torgersen -4.69 3.44 190 3650 ## 6 Adelie Torgersen -5.09 0.635 181 3625 ## 7 Adelie Torgersen -4.79 2.44 195 4675 ## 8 Adelie Torgersen -2.89 0.435 182 3200 ## 9 Adelie Torgersen -5.39 4.04 191 3800 ## 10 Adelie Torgersen -9.39 3.94 198 4400 ## # ℹ 323 more rows ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; centralized &lt;- function(x) {x - mean(x)} penguins %&gt;% mutate(across(c(bill_length_mm, bill_depth_mm), centralized)) ## # A tibble: 333 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen -4.89 1.54 181 3750 ## 2 Adelie Torgersen -4.49 0.235 186 3800 ## 3 Adelie Torgersen -3.69 0.835 195 3250 ## 4 Adelie Torgersen -7.29 2.14 193 3450 ## 5 Adelie Torgersen -4.69 3.44 190 3650 ## 6 Adelie Torgersen -5.09 0.635 181 3625 ## 7 Adelie Torgersen -4.79 2.44 195 4675 ## 8 Adelie Torgersen -2.89 0.435 182 3200 ## 9 Adelie Torgersen -5.39 4.04 191 3800 ## 10 Adelie Torgersen -9.39 3.94 198 4400 ## # ℹ 323 more rows ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; # 数据标准化 mutate + across std &lt;- function(x) { (x - mean(x, na.rm = TRUE)) / sd(x, na.rm = TRUE) } penguins %&gt;% mutate(across(c(bill_length_mm, bill_depth_mm), std)) ## # A tibble: 333 × 8 ## species island bill_length_mm bill_depth_mm flipper_length_mm body_mass_g ## &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; ## 1 Adelie Torgersen -0.895 0.780 181 3750 ## 2 Adelie Torgersen -0.822 0.119 186 3800 ## 3 Adelie Torgersen -0.675 0.424 195 3250 ## 4 Adelie Torgersen -1.33 1.08 193 3450 ## 5 Adelie Torgersen -0.858 1.74 190 3650 ## 6 Adelie Torgersen -0.931 0.323 181 3625 ## 7 Adelie Torgersen -0.876 1.24 195 4675 ## 8 Adelie Torgersen -0.529 0.221 182 3200 ## 9 Adelie Torgersen -0.986 2.05 191 3800 ## 10 Adelie Torgersen -1.72 2.00 198 4400 ## # ℹ 323 more rows ## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt; # using across() and purrr style penguins %&gt;% summarise( across(starts_with(&quot;bill_&quot;), ~ (.x - mean(.x)) / sd(.x)) ) ## Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in ## dplyr 1.1.0. ## ℹ Please use `reframe()` instead. ## ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()` ## always returns an ungrouped data frame and adjust accordingly. ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was ## generated. ## # A tibble: 333 × 2 ## bill_length_mm bill_depth_mm ## &lt;dbl&gt; &lt;dbl&gt; ## 1 -0.895 0.780 ## 2 -0.822 0.119 ## 3 -0.675 0.424 ## 4 -1.33 1.08 ## 5 -0.858 1.74 ## 6 -0.931 0.323 ## 7 -0.876 1.24 ## 8 -0.529 0.221 ## 9 -0.986 2.05 ## 10 -1.72 2.00 ## # ℹ 323 more rows # across 多列多个统计函数 penguins %&gt;% group_by(species) %&gt;% summarise( across(ends_with(&quot;_mm&quot;), list(mean = mean, sd = sd), na.rm = TRUE) ) ## Warning: There was 1 warning in `summarise()`. ## ℹ In argument: `across(ends_with(&quot;_mm&quot;), list(mean = mean, sd = sd), na.rm = ## TRUE)`. ## ℹ In group 1: `species = Adelie`. ## Caused by warning: ## ! The `...` argument of `across()` is deprecated as of dplyr 1.1.0. ## Supply arguments directly to `.fns` through an anonymous function instead. ## ## # Previously ## across(a:b, mean, na.rm = TRUE) ## ## # Now ## across(a:b, \\(x) mean(x, na.rm = TRUE)) ## # A tibble: 3 × 7 ## species bill_length_mm_mean bill_length_mm_sd bill_depth_mm_mean ## &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Adelie 38.8 2.66 18.3 ## 2 Chinstrap 48.8 3.34 18.4 ## 3 Gentoo 47.6 3.11 15.0 ## # ℹ 3 more variables: bill_depth_mm_sd &lt;dbl&gt;, flipper_length_mm_mean &lt;dbl&gt;, ## # flipper_length_mm_sd &lt;dbl&gt; penguins %&gt;% group_by(sex) %&gt;% summarise(across(starts_with(&quot;bill_&quot;),list(max = max, min = min),na.rm = T)) ## # A tibble: 2 × 5 ## sex bill_length_mm_max bill_length_mm_min bill_depth_mm_max ## &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 female 58 32.1 20.7 ## 2 male 59.6 34.6 21.5 ## # ℹ 1 more variable: bill_depth_mm_min &lt;dbl&gt; "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
